<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8" />
  <meta http-equiv="x-ua-compatible" content="ie=edge,chrome=1" />
  <meta name="viewport" content="width=device-width" />
  <title>Fusion Design Lite - TS</title>
  <link rel="stylesheet" href="/static/layui/css/layui.css" media="all">
</head>

<body>
  <div id="ice-container"></div>
  <script src="/static/layui/layui.js"></script>

  <script>
    layui.use('layim', function (layim) {
      //先来个客服
      layim.config({
        brief: false //是否简约模式（如果true则不显示主面板）
      }).chat({
        name: '客服'
        , type: 'friend'
        , avatar: 'http://tp1.sinaimg.cn/5619439268/180/40030060651/1'
        , id: -2
      });
    });
    const wsUrl = 'ws://127.0.0.1:9528/p1/client';
    let ws = new WebSocket(wsUrl);
    setInterval(() => {
      const pr = {
        mType: 'keepAlive',
        mRes: 'success',
        msg: '连接正常',
        mData: {},
      }
      ws.send(JSON.stringify(pr))
    }, 18000);

    ws.onclose = function (e) {
      console.log(e);
      ws = new WebSocket(wsUrl);
    }
    ws.onerror = function (e) {
      console.log(e);
    }

    ws.onopen = function (e) {
      console.log(e);
    }
    ws.onmessage = function (event) {
      const json = JSON.parse(event.data);
      if (json.mRes === 'success' && json.mType === 'payStatus') {
        if (json.mData.payStatus === 1) {
          success();
        } else if (json.mData.payStatus === 2) {
          fail();
        }
      }
    }
  </script>
</body>

</html>